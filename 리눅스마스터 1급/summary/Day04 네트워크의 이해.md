# 3. 네트워크의 이해

## 3-1. 네트워크의 기초

### 3-1-1. OSI 7 계층

1. OSI 7 계층의 개요
   1. 정의
      - OSI(Open Systems Interconnection Reference Model)
      - ISO에서 컴퓨터 네트워크 프로토콜 디자인과 통신 계층을 구성하여 개발한 네트워크 모델
   2. 특징
      - 개념적 모델, 실제 구현x, 실제 네트워크 구현 시 참조 모델
      - 각 계층은 하위 계층이 제공하는 서비스를 이용, 상위 계층에 서비스 제공
      - 상위 계층 -> 하위 계층 데이터 전달 때 헤더와 트레일러 추가, 캡슐화 진행
      - 하위 계층 -> 상위 계층 데이터 수신 때 헤더와 트레일러 제거, 역캡슐화 수행

2. OSI 7 계층 세부 설명
   1. 1 계층: 물리 계층(Physical Layer)
      - 네트워크의 전기적, 물리적 연결 담당
      - 유선의 경우 케이블의 종류, 무선의 경우 주파수 링크, 핀 배치, 전압, 물리 요건 등 정의
      - 디지털 데이터를 물리 계층의 매체가 전달할 수 있는 신호로 변환
   2. 2 계층: 데이터 링크 계층(Data Link Layer)
      - 회선제어: 신호 간의 충돌 방지
      - 흐름제어: 수신 노드는 수신 속도에 맞추기 위해 송신 노드의 데이터를 느리게 보냄
        - 방법: Stop and wait, Sliding window
      - 오류제어: 오류 검출, 재전송 기능 수행
        - ARQ(Automatic Repeat Request): 수신 측에선 오류 감지시 NAK 반환, 수신측에선 패킷 재전송
        - 방법: 정지 대기 ARQ, Go-Back-N ARQ, SR ARQ
        - FEC(Forward error control): 재전송 하지 않고 직접 오류 정정
      - 2개의 송수신 노드는 식별 가능하도록 MAC(Medium Access Control) 주소를 가지고 있음
      - 송수신측의 물리적 주소 및 오류 검출을 위한 CRC 값을 포함한 해더 및 트레일러 추가
      - 좀 더 세부적으로 매체접근제어(MAC) 계층과 논리연결제어(LLC) 계층으로 나눔
   3. 3 계층: 네트워크 계층(Network Layer)
      - 논리적 주소를 설정, 정확하게 전송하는 역할 수행
      - 경로 설정, 라우팅 기능 제공
      - 혼잡 제어(congestion control), 패킷의 분할 및 병합, 인터네트워킹 기능 제공
   4. 4 계층: 전송 계층(Transport Layer)
      - 프로세스 간 연결 제공, 신뢰성 있는 통신이 가능하도록 역할 수행
      - 주소, 포트 지정, 연결제어, 오류 복구, 흐름 제어 기능 제공
      - 커널의 시스템 콜을 통해 상위 계층에 기능 제공
      - 잘 알려진 전송 계층의 구현사례: TCP/IP
   5. 5 계층: 세션 계층(Session Layer)
      - 연결된 노드 간 메시지 단위로 데이터 전송, 세션 설정 및 유지, 동기 기능, 대화 기능 제공
      - 동기 기능: 통신 양단에서 논리적으로 상호 전송이 잘 되었다는 의미로 동기점(synchronization point)을 설정, 오류 발생 시 동기점 후의 데이터만 복구
      - 대화 기능: 데이터 전송 기능 의미, 신뢰성 보장을 위한 시간 경과에 따라 순차적 동기점 부여, 단계적으로 데이터 전송
   6. 6 계층: 표현 계층(Presentation Layer)
      - 서로 다른 표현 방식을 사용하면 의미 해석 불가, 다양한 표현 방식 제공하고 동일한 표현 방식을 사용할 수 있는 기능 제공
      - 유니코드로 인코딩된 파일을 ASCII로 변환하여 형식을 맞추는 기능을 포함
      - 데이터 암호화와 해독 기능, 압축 및 압축 해제 기능 제공
   7. 7 계층: 응용 계층(Application Layer)
      - 사용자에게 편리한 응용 환경을 제공
      - 전자우편(SMTP), 웹서비스(HTTP), 원격접속(RDP), 파일전송(FTP) 등

3. OSI 7 계층의 전송 단위 및 프로토콜
   | 계층 |  계층 이름   | 전송 단위 |                       설명(장비)                       | 프로토콜                                           |
   | ---: | :----------: | :-------: | :----------------------------------------------------: | :------------------------------------------------- |
   |    1 |     물리     |   비트    | 프레임 물리 매체에 따라 비트 단위로 전송(허브, 리피터) | RS-232, USB, I2C, Bluetooth                        |
   |    2 | 데이터 링크  |  프레임   |   패킷을 프레임 단위로 나누어 전송 (브리지, 스위치)    | Ethernet, Token Ring, FDDI, ATM                    |
   |    3 |   네트워크   |   패킷    |       세그먼트를 패킷 단위로 나누어 전송(라우터)       | IP, ICMP, ARP, RARP, IGMP, BGPG, RIP, IPX          |
   |    4 |     전송     | 세그먼트  |  메시지를 전송에 최적화한 세그먼트 단위로 나누어 전송  | TCP, UDP, RTP                                      |
   |    5 |     세션     |  메시지   |  사용자가 전송하고자 하는 데이터를 메시지 단위로 전송  | SSL, TLS, NetBIOS                                  |
   |    6 | 프레젠테이션 |    ''     |                           ''                           | SMB, AFP, ASN.1                                    |
   |    7 |     응용     |    ''     |                           ''                           | HTTP, SMTP, POP3, IMAP, DNS, NFS, FTP, SSH, TELNET |


### 3-1-2. 네트워크 장비

1. LAN 구성 장비
   1. 네트워크 카드(Network Card)
      - 네트워크 장치, 컴퓨터를 네트워크에 연결 가능하게 함
      - LAN카드: NIC(Local Area Network) 환경에서 연결하는 네트워크 카드
      - 이더넷 카드: 이더넷 방식으로 연결하는 경우
      - OSI 7 계층 중 1 계층과 2 계층의 기능 수행, MAC 주소라는 고유 주소 지정 기능 제공
      - 네트워크 카드는 ISA 방식, PCI 방식 지원, 인터넷의 대중화와 가격 절감을 위해 온보드되어 제공
      - 다양한 방식의 인터페이스의 네트워크 카드들: PCIe, Firewire, USB, Thunderbolt 등
   2. 케이블
      - 네트워크 신호를 전달하는 물리적인 전송 매체
      - 이더넷을 구성하는 케이블: 꼬임선(Twisted Pair Wire), 동축 케이블(Coaxial cable), 광섬유(Optical fiber cable)
   3. 허브
      - 플러딩(flooding) 장치: 다수의 장치를 LAN에 접속할 수 있도록 한 장치에서 전송한 데이터 프레임을 모든 장비에 전송
      - 허브에 다수의 장치를 연결할 때 허브를 중심으로 장치들을 스타형으로 연결
      - 신호 증폭 역할 수행, 전송 거리 연장 기능
      - 장점: 간단하게 네트워크 확장 가능
      - 단점: 패킷을 허브의 모든 포트로 브로드캐스트 -> 데이터 충돌 발생 가능성 높음, 성능 저하

2. 인터네트워크 장비
   1. 리피터
      - 1계층 장비, 데이터 전송 시 감쇄(attenuated)현상으로 인해 신호가 약해 진것을 증폭
   2. 브리지
      - 2계층 장비, 여러 개의 네트워크 세그먼트를 연결하기 위해 MAC 주소를 보고 해당 포트로 데이터를 포워딩함
      - 모든 포트로 플러딩 하지 않아 효과적 프레임 전달 가능
      - 브리지 테이블 관리: 데이터 전송할 포트를 빠르게 찾기 위해
   3. 라우터
      - 독립된 네트워크 서로 연결, 패킷을 목적지까지 효과적인 경로 탐색해 데이터 포워딩
      - 네트워크를 서로 연결해 줌, 라우팅 테이블을 통해 경로 설정 기능
      - 포워딩 기능: 한 포트의 패킷을 다른 포트로 전달
   4. 게이트웨이
      - 프로토콜의 변환 기능 수행, ex) 무선랜을 다른 통신망에 연결하기 위해 게이트웨이 필요

### 3-1-3 데이터 통신의 기본 이해

1. 네트워크 토폴로지
   1. 스타(star)형
      - 중앙 노드와 사용자 노드의 일대일 대응, 이더넷 네트워크에선 중앙에는 허브 위치
      - 장점: 확장 용이, 노드 결함시 다른 노드에 영향x, 결함 허용 능력
      - 단점: 사용자 노드 수 증가시 패킷 충돌 가능성 높아짐, 중앙 노드 고장시 마비
   2. 버스(bus)형
      - 단일 회선(bus)에 사용자 노드가 T자 모양으로 연결, 회선 끝에는 종단기(Terminator)를 설치, 신호 반사 방지
      - 한 시점에 하나의 사용자 노드만 회선을 점유 CSMA/CD, 토큰 패싱(Token Passing)같은 전송 방식 사용
      - 장점: 구조가 간단, 노드 추가 제거 용이, 결함 허용 능력 제공
      - 단점: 대역폭 공유 -> 노드의 수 증가시 성능 저하
   3. 링(ring)형
      - 네트워크의 노드가 원형 연결
      - 장점: 설치 비용 저렴, 넓은 지역 설치 가능
      - 통신 효율성 낮음, 한 노드 장애 발생시 전체 중단, 넓은 지역 구축시 비용 증가
   4. 망(mesh)형
      - 모든 노드가 개별적으로 그물처럼 연결
      - 라우터로 LAN 구성 시 LAN 연결 or 백본망(backbone)을 구성해 사용
      - 장점: 가용성, 효율성이 높음, 장애 발생 시 다른 경로로 데이터 전송 가능
      - 단점: 설치, 관리, 재구성이 어려움, 많은 링크 필요해 설치 비용이 비쌈

2. 네트워크 통신 방식
   1. 이더넷(Ethernet)
      - 이더넷이란? 링크 -> [http://blog.naver.com/haeri056/220805367585](http://blog.naver.com/haeri056/220805367585)
      - LAN, NAN, WAN을 구축하기 위해 일반적으로 사용하는 네트워크 기술
      - 고유의 MAC 주소를 통해 상호간에 데이터를 주고 받을 수 있도록 함
      - CSMA/CD 기술 사용해 이더넷에 연결된 여러 컴퓨터들이 하나의 전송 매체를 공유할 수 있도록 함
      - 전송속도: 기본 10Mbps ~ 1Gbps 지원, 비동기식 직렬 통신과 부호화 방식으로 맨체스터 인코딩 사용
      - 데이터는 이더넷 프레임 형식으로 전달, 송수신 MAC 주소를 포함하는 헤더 14bytes, 최대 전송 크기 1500bytes, 마지막엔 FCS(Frame Check Sequence)가 붙음
      - 전송 매체는 동축(BNC), UTP, STP 등 사용, 네트워크 기기를 연결하기 위해 허브, 스위치, 리피터 등 장치 사용
      - 이더넷은 반이중통신(half duplex) 지원, CSMA/CD로 데이터 전송
      - 2, 5는 동축 케이블 의미, 약 200m, 500m 를 의미함
      - T: Twisted 케이블, TX: UTP-5 or STP, FX: 광케이블, SX: 단파장 광섬유, LX: 장파장 광섬유
   2. 토큰링(Token Ring)
      - LAN 구축하기 위해 토큰을 획득한 노드만 데이터를 전송할 수 있는 네트워크 기술
      - 스위치 이더넷 보급 후 쇠퇴, 그 이전엔 이론적으로 빠르고 안정적 기술로 각광
   3. FDDI(Fiber Distributed Data Interface)
      - LAN들을 연결하는 백본(backbone)망을 구성하기 위해 주 링(primary ring)과 부 링(secondary ring)으로 구성된 이중 링(dual ring)에 스테이션이 연결, 100Mbps의 대역폭을 갖는 네트워크 기술

3. 네트워크 유형
   1. LAN(Local Area Network)
      - 한정된 지역에 로컬로 네트워크 구성
      - 일반적으로 이더넷과 TCP/IP를 통해 구축, 무선 방식은 IEEE802.11 표준에 따라 무선랜을 구축
   2. MAN(Metropolitan Area Network)
      - LAN보다 범위가 크고 WAN보다 범위가 작은 도시권 통신망
      - IEEE802.6 에 정의된 DQDB(Distributed Queue Dual Bus) 토폴로지 기법 사용
   3. WAN(Wide Area Network)
      - 광역 통신망, 전용 회선 방식은 통신 사업자가 계약 체결해 안정성 우수, 비용이 비쌈

4. 교환 방식
   1. 회선 교환 방식(Circuit Switched Network)
      - 사용자 간 미리 연결 설정, 회선 점유, 연결되어 있는 경우 기다려야 함
      - 전화, PSTN
   2. 패킷 교환 방식(Packet Switch Network)
      - 대역폭 낭비 최소화, 데이터를 일정 크기로 분할한 패킷 송수신
      - 회선 공유, 대역폭 이용 효율 극대화, 무제한 사용자 연결 가능, 패킷마다 우선순위 부여
      - 패킷 생성을 위해 헤더가 추가되 오버헤드로 인한 성능 저하와 지연 현상 발생 가능
      - 데이터그램(datagram) 방식과 가상 회선(virtual circuit) 구분
        - 데이터그램 방식: 논리적 연결x, 패킷이 독립적 전송, 도착 순서가 바뀔 수 있음, 짧은 메시지 일시적 전송 적합
        - 가상 회선 방식: 논리적 연결o, 경로 설정 한번만 수행, 동일 경로로 전달, 도착 순서 보장, 다량의 데이터 연속 전송 적합

5. 패킷 교환 기술
   1. X.25
      - 표준화된 통신 규약 개발: 초기 컴퓨터 통신망은 전화망을 이용, 통신사마다 독자적 프로토콜 사용, 호환성 문제
      - X.25는 DTE(Data Terminal Equipment)와 DCE(Data Circuit-terminating Equipment)간의 점대점 인터페이스 정의
   2. 프레임 릴레이
      - 고속망에 대한 사용자 요구에 대응하기 위해 개발한 패킷 교환 기술
      - 통계적 다중화(Statistical Multiplexing) 기능을 제공해 효율적인 대역폭 사용 제공
      - 오류 제어 기능을 단순화, 데이터 재전송과 같은 오류 복구 기능을 상위 프로토콜에 일임함
   3. 셀 릴레이(ATM: Asynchronous Transfer Mode)
      - ATM 기술로 속도 향상
      - 모든 정보를 48bytes로 구분, 블록 생성, 5bytes에 해더를 붙인 셀로 전송, 교환
      - 전송속도: 56kbit/s ~ 수Gbit/s, 흐름제어와 오류제어 기능x

### 3-1-4. TCP/IP 및 네트워크 프로토콜의 이해

1. 프로토콜
   1. 프로토콜의 개요
      - 컴퓨터나 통신 장비 사이에 메시지를 주고 받는 양식이나 규칙의 체계
      - 형식(Syntax), 의미(Semantic), 타이밍(Timing)으로 구성
      - 형식: 데이터의 구조나 형식을 말함
      - 의미: 형식에 따라 담긴 데이터를 어떻게 해석할 것인가, 어떤 기능을 수행하는가
      - 타이밍: 의미를 담은 데이터가 어떤 순서로 오고 가고 하는지와 속도 정의
   2. 프로토콜의 기능
      - 에러제어(error control): 데이터 전송 중 에러 검출 및 에러 정정 정의
      - 캡슐화(encpasulation): 통신 계층상 각 계층마다의 특정 제어 정보 정의
      - 연결제어(connetcion control): 연결 지향 통신에서 연결의 설정, 데이터 송수신, 연결 종료 절차 정의
      - 순서제어(sequence control): 패킷의 순서의 역전, 중복 패킷 발생 방지
      - 흐름제어(flow control): 보낼 데이터의 양 조절
      - 혼잡제어(congestion control): 대기하고 있는 패킷의 양 조절, 패킷이 혼잡해지지 않도록 조절
      - 동기화(synchronization): 데이터 송수신 측의 타이머 값, 윈도우 크기 등 매개변수 정보를 일치하는 방법 제공
      - 주소지정(addressing): 여러 개체 중 하나의 개체를 식별할 수 있는 방법 제공
      - 단편화 및 재조정(fragmentation and reassembly): 데이터를 분할 전송, 재조립 하는 방법 제공
      - 데이터 형식화(data formatting): 전송 데이터의 형식이 무엇인지 방법 제공
   3. 표준 제정 위원회
      - 국제표준기구(ISO, International Standards Institute): 각 국의 표준제정위원회에서 선정된 위원들로 구성된 다국적 기구
      - 미국국립표준협회(ANSI, American National Standards institute): 사립 비영리 법인
      - 국제전기통신연합(ITU-T, International Telecommunications Union): UN 산하기구
      - 전기전자공학회(IEEE, Institute of electrical and electronic engineers): 세계에서 가장 규모가 큰 전문공학학회
      - 전자산업협회(EIA, Electronic Industries Association): 제조업체 중심의 비영리 기관
      - 한국정보통신기술협회(TTA, Telecommunications Technology Association): 국내외 정보통신분야 기여

2. TCP/IP
   1. TCP/IP 개요
      - 인터넷 프로토콜: 네트워크를 구현 위해 장비들과 종단 호스트 간의 연결과 라우팅을 제공
      - 주요 프로토콜은 TCP, IP임, 보통 UDP, ARP, RARP 등 관련된 프로토콜도 지칭함
   2. TCP/IP 구조
      ![Day04 TCP&IP.png](../assets/Day04%20TCP&IP.png)
      - 4계층으로 구성: 네트워크 액세스 계층, 인터넷 계층, 전송 계층, 응용 계층
      - 네트워크 엑세스 계층(network access)
        - 실제 통신을 수행하는 하드웨어 인터페이스
        - CSMA/CD와 MAC 프로토콜을 사용하는 이더넷이 가장 널리 사용
      - 인터넷 계층(internet)
        - 전동 계층에서 전달한 패킷을 서브 네트워크와 무관하게 목적지 주소까지 효율적으로 전달
        - 패킷의 정확한 도착, 손상 여부는 상위 계층에 위임
      - 전송 계층(transport)
        - 응용 계층에서 전송한 데이터를 연결 지향 데이터 스트림 지원, 신뢰성, 흐름제어, 다중화 같은 서비스 제공
        - 세그먼트(segment)나 데이터그램(datagram)으로 구성해 전송
      - 응용 계층(application)
        - 응용 프로그램 간 통신 접속을 위한 통신 프로토콜을 보유한 추상 계층
   3. TCP와 UDP
      - TCP
        - 연결을 먼저 설정, 연결 지향(connection oritented) 전송 프로토콜, 가상 회선 방식 제공
        - 3-way handshake 과정을 통해 연결, 4-way handshake를 통해 해제
          - 3-way handshake: SYN 패킷 전달 -> SYN-ACK 응답 -> ACK 전달해 연결 확실 -> ESTABLISHED 받음
        - 패킷의 원활한 전달을 위해 흐름제어 및 혼잡제어 제공
        - 신뢰성 보장, ACK 패킷 수신 여부 확인해 속도가 느림
        - 전이중 방식전송으로 전송과 수신을 동시에 수행 가능, 점대점 연결 제공
      - UDP
        - 비연결형 서비스, 데이터그램 방식, 사용자의 데이터를 전달
        - 전송이 잘 되었는지 확인하는 절차가 없어 신뢰성이 낮지만 빠름
        - UDP 헤더에 CheckSum 필드를 통해 최소한의 오류만 검출
   4. 포트 번호
      - 상위 응용 계층의 다양한 프로그램을 다중화 하기 위해 각각의 포트를 부여
      - 0~65535 사이의 정수값
      - 0~1023 well known port로 시스템에서 사용하는 포트들
      - `/etc/services` 파일에서 주요 포트 번호 확인 가능
         | 포트 | TCP | UDP | 설명                                                           |
         | ---- | --- | --- | -------------------------------------------------------------- |
         | 0    |     | UDP | 예약됨: 사용x                                                  |
         | 13   | TCP | UDP | DAYTIME 프로토콜                                               |
         | 20   | TCP |     | FTP 데이터 포트                                                |
         | 21   | TCP |     | FTP 제어 포트                                                  |
         | 22   | TCP |     | SSH(Secure Shell) 같은 프로토콜 및 포트 포워딩                 |
         | 23   | TCP |     | 텔넷 프로토콜 - 암호화되지 않은 텍스트 통신                    |
         | 25   | TCP |     | SMTP(Simple Mail Transfer Protocol - 이메일 전송에 사용        |
         | 37   | TCP | UDP | TIME 프로토콜                                                  |
         | 53   | TCP | UDP | DNS(Domain Name System)                                        |
         | 67   |     | UDP | BOOTP(부트스트랩 프로토콜) 서버, DHCP로도 사용                 |
         | 68   |     | UDP | BOOTP(부트스트랩 프로토콜) 클라이언트, DHCP로도 사용           |
         | 80   | TCP | UDP | HTTP(HyperText Transfer Protocol) - 웹 페이지 전송             |
         | 110  | TCP |     | POP(Post Office Protocol version 3) - 전자우편 가져오기에 사용 |
         | 123  |     | UDP | NTP(Network Time Protocol) - 시간 동기화                       |
         | 143  | TCP |     | IMAP4(인터넷 메시지 접근 프로토콜 4) - 이메일 가져오기에 사용  |
         | 161  |     | UDP | SNMP(Simple Network Management Protocol) - Agent 포트          |
         | 443  | TCP |     | HTTPS - SSL 위의 HTTP(암호화 전송)                             |
         | 873  | TCP |     | rsync 파일 동기화 프로토콜                                     |
   5. 소켓
      - 네트워크 프로그램이 데이터 통신을 하기 위한 접점(endpoint)
      - 데이터 동신을 위해 소켓 생성, 상대방 소켓에 접속해 상호 간 데이터를 교환
      - 구성: 인터넷 프로토콜, 로컬 시스템의 IP 주소 및 포트번호, 원격 시스템의 IP 주소와 포트 번호

3. IP 주소(internet protocol address)
   1. IP 주소
      - 통신을 위한 특수한 번호, 발신지와 수신지 명시
      - DHCP 서버에 의한 동적 할당, 고정 할당 존재
      - 32bit로 0~255값, 10진수 표시, .으로 구분, 약 42억 9천만개 존재
      - 약 6억개 예약 IP, 중간 일부 번호는 특별한 용도로 씀, 예) 127.0.0.1은 localhost로 자기 자신
      - 첫 번째 1byte 값에 따라 A, B, C, D, E 클래스로 나눔
   2. IP 주소의 클래스
      - A~C 클래스는 일반 목적, D, E는 특수 목적으로 사용
      - A 클래스: 첫 번째 바이트 중 첫 번째 비트가 0으로 시작, 1~126은 주소로 사용, 127은 예약 주소
      - B 클래스: 첫 번째 바이트 중 앞선 두 비트가 10, 128~192는 주소로 사용
      - C 클래스: 첫 번째 바이트 중 앞선 세 비트가 110, 192~223은 주소로 사용
      - D 클래스: 첫 번째 바이트 중 앞선 네 비트가 1110, 224~239는 주소로 사용 가능, 다중방송통신(multicast)용으로 예약
      - E 클래스: 첫 번째 바이트 중 앞선 네 비트가 1111, 연구용 예약
   3. 특수 목적 IP 주소
      - 일반 목적 외에 특수 목적으로 사용하는 주소 존재
      - 네트워크를 구축하기 위한 사설 IP 주소, 루프백 IP 주소
      - 사설 IP 주소는 A 클래스에 1개의 네트워크, B 클래스에 16개, C 클래스에 256개
      - 루프백 IP 주소는 A 클래스의 127.0.0.0 ~ 255.255.255.255 범위 사용

4. 서브넷(subnetting)
   1. 서브넷의 필요성
      - 호스트 주소 중 일부를 서브넷의 네트워크 주소로 사용, 네트워크르 ㄹ분할
      - 브로드캐스트의 크기를 작게 하고 주소 절약, 라우팅 정보의 크기를 감소하기 위해
      - 서브넷을 사용하면 B 클래스(65,536개의 호스트)와 C 클래스(256개)의 사이의 호스트 수 구축 가능
   2. 서브넷마스크(subent mask)
      - 네트워크 주소와 호스트 주소를 분리하는데 사용, AND 연산 원리로 네트워크 주소가 분리
      - A 클래스는 네트워크 주소가 상위 1byte 임으로 서브넷 마스크는 255.0.0.0
      - B 클래스는 네트워크 주소가 상위 2bytes 임으로 서브넷 마스크는 255.255.0.0
      - C 클래스는 255.255.255.0
   3. 서브넷마스크와 호스트의 갯수
      - 서브넷 마스크가 255.255.255.0 이면 호스트의 수는 256개에서 네트워크 주소 예약, 브로트캐스트, 게이트웨이 주소 예약되어 253개 호스트 사용 가능
   4. C 클래스 기준 서브넷 구성해보기
      - C클래스의 서브넷 마스크 사용 하나의 네트워크 사용 -> 서브넷마스크를 255.255.255.192로 설정하면 4개로 운영 가능
      - 192는 11000000 이여서 앞의 2 비트를 4개로 나눠서 네트워크로 사용 가능하기 때문
      - 3단계 주소 형식을 사용: 네트워크 ID, 서브넷 ID, 호스트 ID 로 구성해 사용

5. 도메인(domain)
   1. 도메인네임(Domain Name)
      - IP를 기억하기 쉽도록 이름을 부여하는 메커니즘
      - 국제인터넷주소자원관리기관(ICANN)에서 새로운 도메인 계속적으로 발행, 관리, 다양한 언어 제공
   2. 도메인 체계
      - .(dot)으로 구분, 다단계 계층 트리 구조
      - 루트 도메인: 도메인 이름.최상위 도메인 ex) naver.com
      - 서브 도메인: ex) www.
      - 프로토콜: ex) http://
      - 최상위 도메인: 일반 최상위 도메인(gTLD: generic TLD)와 국가 코드 최상위 도메인(ccTLD country code TLD)(ISO-3166에 따름)
      - 2단계 도메인: co, go, or 같은 기관 이름이나 종류
   3. 도메인네임 시스템(DNS: Domain Name System)
      - 호스트의 도메인네임을 IP주소로 변환해주는 시스템
      - 인터넷 사업자가 제공하는 DNS 서버에 도메인네임을 질의하면 IP 주소로 반환
   4. ICANN(Internet Corporation for Assgined Names and Numbers)
      - 국제인터넷주소관리기구, 비영리기관
      - 인터넷 DNS의 기술적 관리, IP 주소 공간 할당, 프로토콜 파라미터 지정, 루트 서버 시스템 관리 등 업무를 조정하는 역할

6. IPv6(Internet Protocol version 6)
   1. IPv6 개요
      - IPv4의 IP 고갈 문제 해결, 128비트 확장한 차세대 인터넷 프로토콜
      - 16bit 단위로 8자리로 구성, :으로 구분, 16진수 값으로 표기, 연속된 0은 생략
   2. 특징
      - 헤더 구조를 단순화: 기본 제공 헤더를 확장 헤더로 옮김, 기본 헤더에서 포함하는 필드 12개에서 8개로 줄어듬
      - 모든 기기에 주소를 할당 가능, NAT 기술 불필요
      - 호스트 주소를 자동 할당 받을 수 있음
      - 패킷 출처 인증, 데이터 무결성 및 비밀 보장 기능을 확장 헤더를 통해 기본으로 인증 및 보안 기능 제공
      - 흐름 레이블 필드를 통해 트레픽 구분, 라우터에 의해 QoS 처리 가능
   3. IPv4와의 비교
      | 구분          | IPv4                          | IPv6                                            |
      | ------------- | ----------------------------- | ----------------------------------------------- |
      | 주소 길이     | 32bit                         | 128bit                                          |
      | 주소 갯수     | 약 43억개                     | 약 43억개의 4승                                 |
      | 품질 제어     | 품질 보장 곤란(QoS 일부 지원) | 등급별, 서비스별 패킷 구분 가능, 품질 보장 용이 |
      | 보안 기능     | IPsec 프로토콜 별도 설치      | 확장 기능으로 기본 제공                         |
      | 자동 네트워킹 | 곤란                          | 가능(Auto-configuration)                        |
      | 이동성 지원   | 곤란(비효율적)                | 용이(효율적)                                    |

## 3-2. 네트워크의 설정

### 3-2-1. 환경설정

1. 리눅스 네트워크 환경설정 개요
   1. 호환성
      - 네트워크 디바이스 호환성 제공
      - 확인 방법은 리눅스 배포판 운영 사이트에서 참고
   2. 다양성
      - 네트워크 프로토콜과 다양한 네트워크 디바이스 기본 제공
      - 제공하지 않는 디바이스면 제조사 사이트 참조해 커널 버전과 호환되는 모듈 파일 다운받아 설치

2. 인터넷 접속을 위한 이더넷 카드(Ethernet card) 설치하기
   1. 대부분의 이더넷 카드 드라이버는 배포판에 포함, 별도 설치 필요x
   2. 최신 이더넷 카드는 포함되지 않을 경우 제조사에서 적합한 드라이버를 찾아 설치
   3. 드라이버 다운 후 `modprobe`, `insmod`를 통해 드라이버를 시스템에 로드
   4. 드라이버 자동 로드될 수 있도록 `/etc/modprobe.d` 디렉터리 안에 설정 필요

3. 인터넷 접속을 위한 네트워크 인터페이스 설정 방법
   1. GUI 기반 네트워크 설정(CentOS 6.9기준)
      - 교재 참고(p.1-167)
   2. 텍스트 기반 네트워크 설정
      - 방법1: `setup` -> `Network configuration` -> `Device configuration` 선택
      - 방법2: `system-config-network` -> `Device configuration` 선택
      - DHCP 서버로부터 IP 주소 자동 받기 or 수동 설정 가능
      - `$ sudo service network restart`로 네트워크 서비스 재시작해야 반영
   3. 명령어를 통한 IP 수동 설정
      - IP 수동 설정: `ifconfig eth0 192.168.100.100 netmask 255.255.255.0 broadcast 192.168.100.255`
      - 활성화: `ifconfigeth0 up`
      - 설정 값은 영구적x, 네트워크 서비스 재시작이나 시스템 재부팅시 수동 설정값이 지워짐
      - 게이트웨이 주소 입력해 라우팅 테이블에 게이트웨이 주소 추가: `route add default gw 192.168.100.1`
   4. 네트워크 설정 파일을 통한 IP 수동 설정
      - `/etc/sysconfig/network-scripts/ifcfg-eth0`: 인터페이스마다 환경설정
      - `/etc/sysconfig/network`: 시스템 전체 적용할 기본 설정
      - `/etc/resolv.conf`: 네임 서버 설정, 기본으로 사용할 도메인명 설정
      - `/etc/hosts`: IP 주소와 도메인 이름 간의 매핑 테이블, 해당 시스템에서만 사용하는 정보 미리 입력 가능
      - 위에 파일들을 수정 후 `service network restart` 입력 후 반영

### 3-2-2. 네트워크 설정 명령어

1. ifconfig
   1. 설명
      - 네트워크 인터페이스에 대한 환경설정, 보통 시스템 시작된 후 네트워크 설정 조절
   2. 형식
      - `ifconfig [interface] options | address ...`
   3. 네트워크설정 보기
      - `ifconfig`로 출력하기
      - 출력 정보 설명
        - Link encap: 네트워크 인터페이스의 유형
        - Hwaddr: 이더넷 카드의 MAC 주소
        - inet addr: IP 주소
        - Bcast: 브로드캐스트 주소
        - Mask: 넷마스크 주소
        - UP: 인터페이스 활성화 상태
        - BROADCAST: 브로드캐스트 사용
        - RUNNING: 인터페이스 동작 중
        - MULTICST: 멀티캐스트 사용 가능
        - MTU: MTU(Maximum Transmission Unit) 설정값
        - Metric: 라우팅 정보로서 거리값
        - RX/TX: RX는 수신 패킷, TX는 송신 패킷
        - Collisions: 충돌 패킷 개수
   4. 모든 네트워크 인터페이스의 설정 보기
      - `ifconfig -a`
   5. 특정 네트워크 인터페이스의 설정 보기
      - `ifconfig eth0` 
   6. 특정 네트워크 인터페이스 활성화 및 비활성화 하기
      - `ifconfig eth0 up`
      - `ifconfig eth0 down`
   7. 네트워크 설정하기
      ```bash
      # 고정 IP 설정, 넷마스크 설정, 브로드캐스트 설정, 인터페이스 활성화
      ifconfig wlan0 192.168.100.100 netmask 255.255.255.255 broadcast 192.168.100.253 up
      ```

2. route
   1. 설명
      - 시스템에 설정된 라우팅 테이블을 표시, 수정
      - 패킷의 목적지 주소와 넷마스크를 AND 연산해 네트워크 주소와 라우팅 테이블과 매칭되는 경로가 있으면 해당 경로에 설정된 네트워크 인터페이스를 통해 패킷을 라우팅함
   2. 형식
      - `route add|del [-net|-host] target [netmask Nm][gw Gw][[dev] lf]`
   3. 라우팅 테이블 출력하기
      - `route`: 기본 출력
      - `route -n`: 심볼 출력x, 그대로 숫자 표시
      - 라우팅 테이블 각 정보
        - Destination: 목적지 호스트나 네트워크 주소
        - Gateway: 외부 네트워크와 연결되어 있는 게이트웨이 주소
        - Genmask: 패킷의 목적지 주소에서 네트워크 주소를 계산하기 위한 넷마스크 주소, `0.0.0.0` 이나 `*` 인 경우 내부 네트워크
        - Flags: 라우팅 경로의 플래그
          - `U`: 라우팅 정보가 유효
          - `H`: 목적지가 호스트
          - `G`: 목적지로 가려면 게이트웨이 경유 필요
          - `D`: 데몬 또는 ICMP 리다이렉트 메시지를 통해 설치된 상태
          - `M`: 데몬 또는 ICMP 리다이렉트 미시지를 통해 수정된 상태
        - Metric: 목적지까지의 도달 비용을 숫자로 환산한 특정 값, 라우터는 작은 값을 선택함
        - Ref: 경로를 참조한 횟수
        - Use: 경로를 탐색한 횟수
        - Iface: 목적지 네트워크나 호스트로 패킷을 내보낼 네트워크 인터페이스
   4. 디폴트 게이트웨이 추가 및 삭제하기
      - `route add default gw 10.0.2.2 dev eth0`: default gw 옵션을 사용해 디폴트 게이트웨이 추가
      - 디폴트 게이트웨이 추가 후 라우팅 정보를 보면 Destination에 default가 설정, Flags는 G로 설정됨
      - `route del default gw 10.0.2.2`: 디폴트 게이트웨이 삭제
   5. 특정 네트워크에 대한 라우팅 정보 추가 및 삭제하기
      - `sudo route add -net 10.0.2.128 netmask 255.255.255.128 gw 10.0.2.2 dev eth0`
   6. 특정 호스트에 대한 라우팅 정보 추가 및 삭제하기
      - `route add -host 10.0.2.50 dev eth0`: -host 옵션을 사용해 특정 호스트를 목적지로 하는 라우팅 정보 추가

3. arp
   1. 설명
      - 이더넷 기반 IP 통신은 호스트 주소를 랜카드의 MAC 주소(HW 주소)로 변환해야 함
      - 호스트 주소에 대한 MAC 주소를 알려면 ARP 프로토콜 사용, 알아낸 MAC 주소를 ARP 캐시에 저장
   2. 형식
      - `arp [-a] [hostname]`
      - `arp -s hostname hwaddr`
      - `arp -d hostname`
   3. arp 캐시 보기
      - `arp -e|a`: ARP 캐쉬를 BSD 스타일|리눅스 스타일 로 표시
   4. arp 캐시에 정보 추가 및 삭제하기
      - `arp -s 10.0.2.3 11:22:33:44:55:66`: ARP 캐시에 직접 IP 주소와 MAC 주소 입력 가능
      - `arp -d 10.0.2.3`: ARP 캐시에서 특정 IP 주소의 정보를 삭제
   5. 그 밖의 옵션
      - `-n`: 도메인 주소 대신에 IP 주소를 출력
      - `-v`: 관련 정보를 자세히 출력

### 3-2-3. 네트워크 진단 명령어

1. ethtool
   1. 설명
      - 네트워크 인터페이스 카드를 위한 설정 도구
      - 네트워크 속도, 포트, 자동 설정 등 카드의 설정 변경 가능
   2. 형식
      - `ethtool [options] interface
   3. 예제
      - `ethtool -i eth0`: 네트워크 인터페이스 디바이스 드라이버 정보 보기

2. ip
   1. 설명
      - 시스템의 네트워크 인터페이스에 주소 할당, 파라미터 설정 기능을 수행하는 ifconfig를 대체하는 명령어
   2. 형식
      - `ip [options] [command] [address] [dev interface]`
   3. 주요 옵션
      - `route`: 라우팅 테이블에 항목 추가나 삭제
      - `addr`: 네트워크 인터페이스의 IP 정보를 출력
      - `link`: 네트워크 인터페이스에 상태를 설정
      - `neighbor`: ARP 캐시를 관리
   4. 네트워크 인터페이스의 정보 출력
      - `ip addr` or `ip addr show` or `ip addr list`
   5. IP 할당 및 제거
      - `ip addr add 192.168.100.100/24 dev eth0`: 네트워크 인터페이스에 IP 할당 / 넷마스크 할당
      - `ip addr add 192.168.100.100/255.255.255.0 dev eth0`: 위와 같음
      - `ip addr add broadcast 192.168.100.255 dev eth0`: 네트워크 인터페이스에 브로드캐스트 주소 할당
      - `ip addr del 192.168.100.100/24 dev eth0`: 네트워크 인터페이스에 IP 주소 삭제
   6. 네트워크 인터페이스 상태 및 파라미터 변경
      - `ip link set dev eth0 down|up`: 네트워크 인터페이스를 비활성화|활성화
      - `ip link set mut 9000 dev eth0`: 네트워크 인터페이스의 MUT(Maximum Transfer Unit) 변경
   7. 네트워크 인터페이스의 ARP 캐시 관리
      - `ip neighbor show`: 네트워크 인터페이스의 ARP 캐시 정보를 출력
      - `ip neighbor add 192.168.101.10 lladdr 11:22:33:44:55:66 dev eth0 nud perm`: 네트워크 인터페이스의 ARP 캐시 정보 추가
      - `ip neighbor del 192.168.101.10 dev eth0`: 캐시 정보 삭제
   8. 라우팅 정보 관리
      - `ip route` or `ip route list`: 라우팅 정보 출력
      - `ip route add 10.0.2.128/25 via 10.0.2.130 dev eth0`: 라우팅 정보 추가
      - `ip route del 10.0.2.128/25`: 라우팅 정보 삭제

3. ping
   1. 설명
      - ping은 ICMP(Internet Control Message Protocol)을 이용한 네트워크 상태 진단 도구
      - 원격 호스트가 네트워크에 연결된 상태인지 확인, 네트워크 지연시간 측정
   2. 형식
      - `ping options hostname|address`
   3. 주요 옵션
      - `-c count`: 핑을 보낼 횟수(기본 값은 무제한)
      - `-i interval`: 핑을 보낼 시간 간격(기본값은 1초)
      - `-s size`: 핑을 보낼 데이터의 크기(최대 65507)
      - `-f`: 핑을 최대한 많이 보냄(flood ping)
      - `-w seconds`: 핑 시작 후 몇 초 뒤에 실행을 멈출지 결정
      - `l interface`: 네트워크 인터페이스가 다수일 경우 핑을 보낼 인터페이스 지정
   4. ping 전송하기
      - `ping -c 10 -s 1000 -i 0.2 8.8.8.8`: -c 만큼 보낼 때마다 -s 만큼 데이터를 보내고 -i 마다 핑 전송
   5. 정한 시간 동안 ping하기
      - `ping -w 3 8.8.8.8`: 3초간 핑 수행
      - icmp_seq를 통해 핑 순서, ttl(time to live)를 통해 라우터를 거친 갯수, time은 응답시간
      - TTL(time to live)
        - ping을 전송하면 ICMP 패킷이 여러 라우터를 거쳐 상대방에 도착
        - TTL의 기본 값은 윈도우 128, 리눅스 64
        - TTL 값이 53이면 기본값 - 53을 해 11개를 거쳤다는 의미, TTL의 기본
        - TTL 기본값 변경: `sysctl net.ipv4.ip_default_ttl=129` or `echo 129 | tee /proc/sys/net/ipv4/ip_default_ttl`

4. netstat
   1. 설명
      - 네트워크 정보를 출력: 네트워크 연결, 라우팅 테이블, 인터페이스의 통계 정보, 마스커레이드 연결, 멀티캐스트 멤버십 등
   2. 형식
      - `netstat options`
   3. 주요 옵션
      - `netstat`: 열려 있는 소켓의 모든 정보를 출력
      - `--route`, `-r`: 라우팅 테이블을 조회
      - `--groups`, `-g`: 멀티캐스트 그룹 멤버십 정보를 조회
      - `--interfaces`, `-i`: 모든 네트워크 인터페이스에 대한 정보를 출력
      - `--masquerade`, `-M`: 마스커레이드 연결의 정보를 출력
      - `--statistics`, `-s`: 각 프로토콜의 통계 정보를 출력
   4. 연결되어 있는 모든 소켓 정보 출력하기
      - `netstat -an`: -a로 연결된 모든 소켓 정보 출력, -n으로 호스트명이나 포트명같은 심볼릭 이름을 사용x하고 숫자로 출력
   5. 라우팅 정보 출력하기
      - `netstat -rn`: 라우팅 정보 출력
   6. 특정 주소 패밀리(address family)에 대한 정보만 출력
      - `netstat -A inet`: IPv4 관련 정보 출력
      - `netstat -A inet6`: IPv6 관련 정보 출력

5. traceroute
   1. 설명
      - 네트워크 장애 분석을 위해 패킷의 경로 전송 추적
   2. 형식
      - `traceroute hostname | address`
   3. 특정 사이트에 어떤 경로로 패킷이 전달되는지 추적하기
      - `traceroute www.google.com`: 라우팅 과정 출력
   4. 다양한 방식을 통해 경로 추적하기
      - `traceroute -I www.google.com`: icmp 방식으로 추적
      - `traceroute -T|U www.google.com`: TCP|UDP 방식으로 추적

6. mil-tool(media independent interface tool)
   1. 설명
      - 네트워크 인터페이스의 연결 상태를 확인 ,설정 변경하는 도구
   2. 형식
      - `mii-tool [option] interface`
   3. 네트워크 인터페이스 정보 출력
      - `mii-tool -v eth0`: -v로 상세 정보 출력
   4. 네트워크 인터페이스 재시작
      - `mii-tool -r eth0`: 재시작
   5. 네트워크 인터페이스 설정 변경
      - `mii-tool -v -F 100baseTx-FD eth0`: 인터 페이스의 정보 강제 변경

7. ss
   1. 설명
      - 소켓에 대한 정보를 제공해 주는 도구
   2. 형식
      - `ss [options] [filter]`
   3. 옵션
      - `-a`: 모든 소켓 정보 출력
      - `-l`: listen 소켓 정보 출력
      - `-t`: TCP 소켓 정보 출력
   4. 주요 예제
      - `ss -t state established`: established 상태의 소켓만 출력
      - `ss -ltn sport le 500`: 필터링 기능 제공, 송신지 포트 500과 같거나 작은 소켓만 출력

### 3-2-4. DNS 명령어

1. nslookup
   1. 설명
      - 네임 서버의 정보 조회, IP를 통해 도메인명을 질의
   2. 형식
      - `nslookup [option] hostname|address [dns]`
   3. 대화형으로 네임 서버 질의하기
      - 옵션없이 `nslookup`을 치면 `>`가 나타나 사용자 입력을 기다림 -> 원하는 도메인 주소 입력시 네임 서버의 정보 출력 -> `exit`로 종료
   4. 옵션으로 네임 서버 질의하기
      - `nslookup www.google.com`: 
      - `nslookup 8.8.8.8`: 
   5. DNS 중 MX(Mail Record) 조회하기
      - `nslookup -type=mx google.com`: 메일 서버 설정에 대한 정보 조회
   6. CNAME과 NS 레코드 조회하기
      - `nslookup -q=cname example.com`: CNAME 조회하기
      - `nslookup -type=ns google.com`: NS 레코드 조회하기
   7. 조회할 네임 서버를 변경하기 위해 마지막 옵션에 DNS 서버의 주소를 입력: `nslookup redhat.com 8.8.8.8`

2. dig
   1. 설명
      - 네임 서버의 정보를 조회, IP를 통해 도메인명을 질의
      - `nslookup`과 기능적 차이 없음, 간결, 출력이 풍부, 셸 스크립트에서 사용 용이
   2. 형식
      - `dig [@nameserver] hostname|address [querytype]`
   3. dig을 통해 다양한 정보 조회하기
      - `dig www.google.com`: www.google.com IP 주소 조회하기
      - `dig www.google.com MX`: 메일 서버 정보 조회하기
      - `dig -t ns www.google.com`: 네임 서버 정보 조회하기
      - `dig @8.8.8.8 www.google.com`: 지정한 네임 서버를 통해 질의하기

3. host
   1. 설명
      - 네임 서버에 질의, 호스트의 정보를 얻는 간단한 도구
   2. 형식
      - `host [option] hostname`
   3. 주요 옵션
      - `-t [A|NS|MX|ANY]`: 호스트IP 주소|검색한 호스트의 네임 서버 호스트명|메일 서버|타입의 모든 정보
      - `-v`: 자세한 정보 출력
      - `-a`: `-v -t ANY` 와 동일
   4. 주요 예제
      - `host -v www.google.com`: 구글의 호스트의 상세 정보(verbose)를 조회

4. hostname
   1. 설명
      - 시스템의 호스트 이름 조회, 설정할 때 사용하는 도구
   2. 형식
      - `hostname [option] [hostname]`
   3. 주요 옵션
      - `-a`: 호스트 명의 별칭(alias)을 출력
      - `-d`: 도메인명 출력
      - `-f`: 완전한 FQND을 출력
      - `-i`: 호스트의 IP 주소를 출력
      - `-s`: FQDN 정보에서 첫 번째 점까지의 정보만 출력
      - `-v`: 호스트 설정이나 호스트명을 자세히 출력
   4. 주요 예제
      - `hostname -i`: 호스트 IP 주소를 출력

### 3-2-5. 네트워크 응용 프로그램

1. telnet
   1. 설명: telnet 프로토콜 기반 대화형 통신을 위한 텔넷 서버에 접속
   2. 형식: `telnet [options] address`
   3. 주요 예제
      ```bash
      telnet mysite.com  # mysite.com에 텔넷 접속
      telnet 192.168.100.80  # 192.168.100.80에 텔넷 접속
      telnet -l myusername mysite.com 6666  # mysite.com에 6666 포트를 통해 텔넷 접속 수행, -l 옵션으로 사용자 계정으로 접속
      telnet  # 대화형 텔넷 접속
      ```

2. ftp
   1. 설명: 파일 전송을 위한 FTP 서버에 접속, 업로드 다운로드 가능
   2. 형식: `ftp hostname | address`
   3. 예제
      ```bash
      $ ftp 192.168.100.77  # IP 주소로 ftp 서버에 접속
      $ ftp ftp.my.com  # 호스트 이름을 통해 ftp 접속
      ```
